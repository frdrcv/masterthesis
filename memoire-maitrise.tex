\documentclass[draft,MScGeogr,nobabel,nonatbib,12pt]{ulthese}
% $pdflatex = "xelatex %O %S";    % à la place de $pdf_mode = 5; dans le fichier latexmkrc
%% Encodage utilisé pour les caractères accentués dans les fichiers
%% source du document. Les gabarits sont encodés en UTF-8. Inutile avec
%% XeLaTeX, qui gère Unicode nativement.
\ifxetex\else \usepackage[utf8]{inputenc} \fi

%\usepackage{xunicode} % Pour l'encodage UTF-8
\usepackage{polyglossia} % Équivalent de Babel
\setdefaultlanguage{french} % Set default language for the Polyglossia package
\setotherlanguage{english}
\usepackage[autostyle=true]{csquotes}
% Corrige un bug de csquotes enlevant les espaces entre les guillemets, entre autres

\makeatletter
\appto\french@punctuation{%
  \XeTeXinterchartoks \french@punctguillstart 255 = {\nobreakspace\xpg@nospace}% "« " -> "«~"
  \XeTeXinterchartoks 255 \french@punctguillend = {\xpg@unskip\nobreakspace}% " »" -> "~»"
  \XeTeXinterchartoks \french@punctguillstart 4095 = {\nobreakspace\xpg@nospace}% "« " -> "«~"
  \XeTeXinterchartoks 4095 \french@punctguillend = {\xpg@unskip\nobreakspace}% " »" -> "~»"
  \XeTeXinterchartoks 4095 \french@punctthin = {\xpg@unskip\nobreak\thinspace}%
  \XeTeXinterchartoks 4095 \french@punctthick = {\xpg@unskip\nobreakspace}%
}
\makeatother

\usepackage[style=authoryear,sortcites,backend=biber,maxbibnames=99,natbib=true]{biblatex}
\emergencystretch=1em %Règle plusieurs problèmes de over/underflow

% Siècles
\def\siecle#1{\textsc{\romannumeral #1}\textsuperscript{e}~siècle}
\def\anglais#1{\textit{#1}}
\def\latin#1{\textit{#1}}
\def\code#1{\texttt{#1}}

% Gestion des acronymes
%\usepackage{acronym}
\usepackage{silence}
\WarningFilter{glossaries}{Overriding \printglossary}
\WarningFilter{glossaries}{overriding `theglossary'}
\usepackage[acronym,xindy,sort=standard,toc,smallcaps,nomain,nonumberlist]{glossaries}
\usepackage{enumitem}
\usepackage{xspace}
\usepackage[textsize=tiny,french]{todonotes}
%\renewcommand{\theglossary}{\begin{description}[font=\normalfont]}
\makeglossaries
\input{acronymes}

% Macros (surtout des acronymes)
\newcommand\agq{\gls{agq}\xspace}
\newcommand\alccva{\gls{alccva}\xspace}
\newcommand\ascgcn{\gls{ascgcn}\xspace}
\newcommand\bdsm{\gls{bdsm}\xspace}
\newcommand\atq{\gls{atq}\xspace}
\newcommand\astteq{\gls{astteq}\xspace}
\newcommand\cadqas{\gls{cadqas}\xspace}
\newcommand\ccglm{\gls{ccglm}\xspace}
%\newcommand\dj{\gls{dj}\xspace}
\newcommand\ggul{\gls{ggul}\xspace}
\newcommand\gps{\gls{gps}\xspace}
\newcommand\grip{\gls{grip}\xspace}
\newcommand\irc{\gls{irc}\xspace}
\newcommand\lgbt{\gls{lgbtq}\xspace}
\newcommand\miels{\gls{miels}\xspace}
\newcommand\mtl{Montréal\xspace}
\newcommand\qc{Québec\xspace}
\newcommand\dyke{\emph{dyke}\xspace}
\newcommand\dykes{\emph{dykes}\xspace}
\newcommand\Dyke{\emph{Dyke}\xspace}
\newcommand\Dykes{\emph{Dykes}\xspace}
\newcommand\dm{\emph{Dyke March} de Montréal\xspace}
\newcommand\mai{\gls{mai}\xspace}
\newcommand\qu{\emph{queer}\xspace}
\newcommand\qus{\emph{queers}\xspace}
\newcommand\rlq{\gls{rlq}\xspace}
\newcommand\rqda{\gls{rqda}\xspace}
\newcommand\sida{\gls{sida}\xspace}
\newcommand\sig{\gls{sig}\xspace}
\newcommand\vih{\gls{vih}\xspace}
\newcommand\uqam{\gls{uqam}\xspace}
\newcommand\uqar{\gls{uqar}\xspace}
\newcommand\fugues{\emph{Fugues}\xspace}
\newcommand\sortie{\emph{Sortie}\xspace}
% Ajout manuel des acronymes pour les arrondissements montréalais
\glsadd{om}
\glsadd{ls}
\glsadd{mr}
\glsadd{vm}
\glsadd{pm}
\glsadd{hs}
\glsadd{so}
\glsadd{rp}
\glsadd{lc}
\glsadd{dv}
\glsadd{mn}
\glsadd{is}
\glsadd{kl}
\glsadd{do}
\glsadd{sv}
\glsadd{ac}
\glsadd{cl}
\glsadd{ln}
\glsadd{mo}
\glsadd{pc}
\glsadd{id}
\glsadd{mh}
\glsadd{cn}
\glsadd{ro}
\glsadd{lr}
\glsadd{bf}
\glsadd{vs}
\glsadd{wm}
\glsadd{me}
\glsadd{aj}
\glsadd{pr}
\glsadd{bv}
\glsadd{vd}
\glsadd{bu}


\renewcommand{\arraystretch}{1.5}

% Source pour les figures
\newcommand{\source}[1]{\caption*{\hfill Source: {#1}} }

% Annotations
%\newcommand{\note}[1]{\color{red}(#1!)\color{black}} % Note importante, en rouge
\newcommand{\missref}{\todo[color=red!40]{Référence manquante}}
%\newcommand{\todo}[1]{\textcolor{blue}{[Todo: #1]}} % À faire

\usepackage{setspace}

\graphicspath{{images/}} % Définir un dossier par défaut pour les images
\usepackage{subcaption} % Plus de legendes possibles
\usepackage{wasysym} % Cases à cocher
\usepackage{longtable} % Tableaux longs

%% Utilisation d'une autre police de caractères pour le document.
%\setmainfont{TeX Gyre Pagella}      % texte en Pagella (Palatino)
%\setmathfont{TeX Gyre Pagella Math} % mathématiques en Pagella (Palatino)
%\setmainfont{TeX Gyre Termes}       % texte en Termes (Times)
\setmainfont{texgyretermes-regular.otf}       % texte en Termes (Times)
%\setmathfont{TeX Gyre Termes Math}  % mathématiques en Termes (Times)

%% Gestion des hyperliens dans le document. S'assurer que hyperref
%% est le dernier paquetage chargé.
\usepackage{hyperref}
\hypersetup{colorlinks,allcolors=ULlinkcolor}

%% Options de mise en forme du mode français de babel. Consulter la
%% documentation du paquetage babel pour les options disponibles.
%% Désactiver (effacer ou mettre en commentaire) si l'option
%% 'nobabel' est spécifiée au chargement de la classe.
%\frenchbsetup{%
%  CompactItemize=false,         % ne pas compacter les listes
%  ThinSpaceInFrenchNumbers=true % espace fine dans les nombres
%}

%% Style de la bibliographie.
%\bibliographystyle{}
\setcounter{biburlnumpenalty}{100}
\addbibresource{/home/nrfrd/Dropbox/bibliographie/literature_repository/library.bib} % Name of the file (without the .bib extension) to use as source for bibliography references
%\DeclareFieldFormat{url}{\space\url{#1}}
%\DeclareFieldFormat{urldate}{\addcomma\space\bibstring{urlseen}\space#1}
%\setcounter{biburlnumpenalty}{100} % Permet une brisure dans les DOI
\DeclareSourcemap{%
  \maps[datatype=bibtex]{%
    \map{%
      \pertype{article}
      \step[fieldset=issn, null]
      \step[fieldset=url, null]
    }
    \map{%
      \pertype{collection}
      \step[fieldset=url, null]
    }
    \map{\pertype{book}
      \step[fieldset=url, null]
      \step[fieldset=doi, null]
    }
    \map{\pertype{online}
      %       \step[fieldset=url, null]
      \step[fieldset=doi, null]
    }
    \map{%
      \step[fieldset=language, null]
    }
  }
}
\DefineBibliographyStrings{french}{%
  urlseen = {visité le},
  in = {},
  mathesis = {Mém.\ de maît.}
}
%\defbibfilter{ressources}{ % Créer une catégorie bibliographique pour "outils" (permet d'exclure)
%type=manual or
%type=online
%}

\titre{Au-delà du territoire}
\soustitre{Espaces et géosymboles de la diversité sexuelle}
\auteur{Frédéric Vachon}
\programme{Maîtrise en Sciences géographiques}
\annee{2017}

\begin{document}
\frontmatter                    % pages liminaires
\pagetitre                      % production de la page titre
\include{resume}                % résumé français
\include{abstract}              % résumé anglais
\cleardoublepage
\tableofcontents                % production de la TdM
\cleardoublepage
\listoftables                   % production de la liste des tableaux
\cleardoublepage
\listoffigures                  % production de la liste des figures
\cleardoublepage
\printglossary[type=\acronymtype,title=Liste des acronymes,toctitle=Liste des acronymes] % production de la liste des acronymes
%\glsaddall
\cleardoublepage
\dedicace{À Marjo, Serge, et leur amour inconditionnel.}
\cleardoublepage
\epigraphe{Texte de l'épigraphe}{Source ou auteur}
\cleardoublepage
\include{remerciements}         % remerciements
\include{avantpropos}           % avant-propos

\mainmatter                     % corps du document
\include{introduction}
\include{chapitres/chapitre1/chapitre1}
\include{chapitres/chapitre2/chapitre2}
\include{chapitres/chapitre3/chapitre3}
\include{chapitres/chapitre4/chapitre4}
\include{conclusion}
\printbibliography%[sorting=nyt]
\appendix                       % annexes le cas échéant
\include{annexe}                % annexe A
\end{document}
